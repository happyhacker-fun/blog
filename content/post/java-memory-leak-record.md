---
title: "Java内存泄漏排查记录"
date: 2020-04-05T23:11:28+08:00
tags: ["java", "memory-leak"]
draft: true
categories: ["in-action"]
---

我们用Java是为了让它自动管理内存，然后我的第一个Java项目上线就面临排查线程数过多导致无法创建新线程、内存泄漏导致机器重启各种个样的问题。这和我原本想象的可不一样。

<!--more-->

```
jstat -gc 1 1000 20

 S0C    S1C    S0U    S1U      EC       EU        OC         OU       MC     MU    CCSC   CCSU   YGC     YGCT    FGC    FGCT     GCT
94720.0 94720.0  0.0   85289.1 5245952.0 1214663.2  808960.0   200733.8  99156.0 77833.4 13440.0 8510.2    135    5.319   4      0.604    5.922
94720.0 94720.0  0.0   85289.1 5245952.0 2898952.8  808960.0   200733.8  99156.0 77833.4 13440.0 8510.2    135    5.319   4      0.604    5.922
94720.0 94720.0  0.0   85289.1 5245952.0 4540248.2  808960.0   200733.8  99156.0 77833.4 13440.0 8510.2    135    5.319   4      0.604    5.922
94208.0 94208.0 84216.2  0.0   5248512.0 1410047.5  808960.0   204709.8  99156.0 77854.8 13440.0 8516.8    136    5.358   4      0.604    5.962
94208.0 94208.0 84216.2  0.0   5248512.0 2771488.9  808960.0   204709.8  99156.0 77854.8 13440.0 8516.8    136    5.358   4      0.604    5.962
94208.0 94208.0 84216.2  0.0   5248512.0 4834580.1  808960.0   204709.8  99156.0 77854.8 13440.0 8516.8    136    5.358   4      0.604    5.962
93184.0 94208.0  0.0   83576.6 5248512.0 1178447.9  808960.0   208501.1  99156.0 77883.4 13440.0 8525.5    137    5.399   4      0.604    6.002
93184.0 94208.0  0.0   83576.6 5248512.0 2967955.8  808960.0   208501.1  99156.0 77883.4 13440.0 8525.5    137    5.399   4      0.604    6.002
93184.0 94208.0  0.0   83576.6 5248512.0 4782412.0  808960.0   208501.1  99156.0 77883.4 13440.0 8525.5    137    5.399   4      0.604    6.002
93184.0 92672.0 84040.8  0.0   5250048.0 1145908.0  808960.0   212756.9  99156.0 77910.1 13440.0 8533.7    138    5.440   4      0.604    6.044
93184.0 92672.0 84040.8  0.0   5250048.0 3234425.1  808960.0   212756.9  99156.0 77910.1 13440.0 8533.7    138    5.440   4      0.604    6.044
93184.0 92672.0 84040.8  0.0   5250048.0 5011301.1  808960.0   212756.9  99156.0 77910.1 13440.0 8533.7    138    5.440   4      0.604    6.044
91648.0 92672.0  0.0   82515.5 5250048.0 1250488.8  808960.0   217357.0  99156.0 77927.9 13440.0 8539.2    139    5.476   4      0.604    6.079
91648.0 92672.0  0.0   82515.5 5250048.0 2697244.6  808960.0   217357.0  99156.0 77927.9 13440.0 8539.2    139    5.476   4      0.604    6.079
91648.0 92672.0  0.0   82515.5 5250048.0 4396252.8  808960.0   217357.0  99156.0 77927.9 13440.0 8539.2    139    5.476   4      0.604    6.079
91648.0 91136.0 84636.1  0.0   5252608.0 682858.0  808960.0   221276.9  99156.0 77951.0 13440.0 8546.3    140    5.513   4      0.604    6.116
91648.0 91136.0 84636.1  0.0   5252608.0 2306010.6  808960.0   221276.9  99156.0 77951.0 13440.0 8546.3    140    5.513   4      0.604    6.116
91648.0 91136.0 84636.1  0.0   5252608.0 4081303.3  808960.0   221276.9  99156.0 77951.0 13440.0 8546.3    140    5.513   4      0.604    6.116
91648.0 91136.0 84636.1  0.0   5252608.0 5200302.4  808960.0   221276.9  99156.0 77951.0 13440.0 8546.3    141    5.513   4      0.604    6.116
91136.0 91136.0  0.0   84998.5 5252608.0 1794610.5  808960.0   225563.7  99156.0 77979.3 13440.0 8554.5    141    5.548   4      0.604    6.151
```

```
jstat -gccause 1 1000 20
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT    LGCC                 GCC
 95.91   0.00  48.51  33.51  79.12  64.70    152    5.927     4    0.604    6.530 Allocation Failure   No GC
 95.91   0.00  85.29  33.51  79.12  64.70    152    5.927     4    0.604    6.530 Allocation Failure   No GC
  0.00  93.76  13.84  34.04  79.18  64.82    153    5.962     4    0.604    6.565 Allocation Failure   No GC
  0.00  93.76  45.72  34.04  79.18  64.82    153    5.962     4    0.604    6.565 Allocation Failure   No GC
  0.00  93.76  72.98  34.04  79.18  64.82    153    5.962     4    0.604    6.565 Allocation Failure   No GC
 96.51   0.00  10.07  34.53  79.23  64.95    154    5.993     4    0.604    6.596 Allocation Failure   No GC
 96.51   0.00  46.64  34.53  79.23  64.95    154    5.993     4    0.604    6.596 Allocation Failure   No GC
 96.51   0.00  84.15  34.53  79.23  64.95    154    5.993     4    0.604    6.596 Allocation Failure   No GC
  0.00  94.27  18.92  35.01  79.30  65.10    155    6.025     4    0.604    6.628 Allocation Failure   No GC
  0.00  94.27  57.54  35.01  79.30  65.10    155    6.025     4    0.604    6.628 Allocation Failure   No GC
  0.00  94.27  91.69  35.01  79.30  65.10    155    6.025     4    0.604    6.628 Allocation Failure   No GC
 91.94   0.00  19.09  35.52  79.34  65.19    156    6.057     4    0.604    6.660 Allocation Failure   No GC
 91.94   0.00  50.14  35.52  79.34  65.19    156    6.057     4    0.604    6.660 Allocation Failure   No GC
 91.94   0.00  84.37  35.52  79.34  65.19    156    6.057     4    0.604    6.660 Allocation Failure   No GC
  0.00  91.10  11.57  36.06  79.38  65.29    157    6.087     4    0.604    6.690 GCLocker Initiated GC No GC
  0.00  91.10  31.98  36.06  79.38  65.29    157    6.087     4    0.604    6.690 GCLocker Initiated GC No GC
  0.00  91.10  57.83  36.06  79.38  65.29    157    6.087     4    0.604    6.690 GCLocker Initiated GC No GC
  0.00  91.10  87.69  36.06  79.38  65.29    157    6.087     4    0.604    6.690 GCLocker Initiated GC No GC
 95.70   0.00  25.26  36.53  79.42  65.37    158    6.119     4    0.604    6.722 Allocation Failure   No GC
 95.70   0.00  62.09  36.53  79.42  65.37    158    6.119     4    0.604    6.722 Allocation Failure   No GC
 ```

Allocation Failure

